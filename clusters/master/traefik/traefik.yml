apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: traefik
  namespace: argocd
spec:
  destination:
    name: ''
    namespace: traefik
    server: 'https://kubernetes.default.svc'
  source:
    path: ''
    repoURL: 'https://helm.traefik.io/traefik'
    targetRevision: 10.20.1
    chart: traefik
    helm:
      values: |-
        providers:
          kubernetesCRD: 
            allowCrossNamespace: true
            allowExternalNameServices: true
        ingressRoute:
          dashboard:
            enabled: false
        log:
          level: info
        ports:
          ssh-teleport:
            port: 3023
            expose: true
            exposedPort: 3023
            protocol: TCP
          k8s-teleport:
            port: 3026
            expose: true
            exposedPort: 3026
            protocol: TCP  
          proxy-teleport:
            port: 3024
            expose: true
            exposedPort: 3024
            protocol: TCP             
        additionalArguments:
          - "--entryPoints.web.forwardedHeaders.trustedIPs=192.168.1.0/24"
          - "--entryPoints.websecure.forwardedHeaders.trustedIPs=192.168.1.0/24"
  project: default
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - PruneLast=true
      - ApplyOutOfSyncOnly=true
      - CreateNamespace=true
