apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: openhab
  namespace: argocd
spec:
  destination:
    name: ''
    namespace: openhab
    server: 'https://kubernetes.default.svc'
  source:
    path: ''
    repoURL: 'https://k8s-at-home.com/charts/'
    targetRevision: 1.4.2
    chart: openhab
    helm:
      values: |-
        service:
          main:
            ports:
              http:
                enabled: true
                port: 8080
              https:
                enabled: true
                port: 8443
        
        ingress:
          main:
            enabled: false
        
        persistence:
          data:
            enabled: true
            type: pvc
            accessMode: ReadWriteMany
            size: 5Gi    
            subPath:
              - mountPath: /openhab/addons
                path: addons
              - mountPath: /openhab/conf
                path: conf
              - mountPath: /openhab/userdata
                path: userdata

  project: default
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - PruneLast=true
      - ApplyOutOfSyncOnly=true
      - CreateNamespace=true
