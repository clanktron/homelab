resources:
  - jellyseerr
  - prowlarr
  - qbittorrent
  - radarr
  - sonarr

patches:
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: \b(radarr|sonarr|prowlarr|qbittorrent)\b
    patch: |
      - op: add
        path: /spec/template/spec/initContainers
        value:
          - name: wireguard
            image: clanktron/wg-quick
            securityContext:
              privileged: true
              capabilities:
                add: [ "NET_ADMIN" ]
            args: [ "up", "wg0" ]
            volumeMounts:
              - name: wireguard-config
                mountPath: /etc/wireguard/wg0.conf
                subPath: wg0.conf
      - op: add
        path: /spec/template/spec/volumes/-
        value:
          name: wireguard-config
          secret:
            secretName: wireguard-config
